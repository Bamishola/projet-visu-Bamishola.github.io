<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PRODMONDE</title>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/topojson-client@3"></script>

  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="brand-title">PRODMONDE</div>
      <div class="brand-sub">Cartographie mondiale des grandes cultures (1961–2024) · Bamishola LOKE | École Centrale Lyon</div>
    </div>

    <nav class="nav">
      <button id="btnDashboard" class="navbtn active">Dashboard</button>
      <button id="btnCountry"   class="navbtn">Détails pays</button>
      <button id="btnStats"     class="navbtn">Statistiques</button>
    </nav>
  </header>

  <!-- PAGE 1 : DASHBOARD -->
  <main id="pageDashboard" class="page">
    <aside class="panel controls">
      <h2>Contrôles</h2>

      <label>Culture</label>
      <select id="selItem"></select>

      <label>Indicateur</label>
      <select id="selElement"></select>

      <label>Année: <span id="lblYear"></span></label>
      <input id="yearSlider" type="range" min="1980" max="2024" step="1" value="1980" />

      <div class="row">
        <button id="btnPlay"  class="btn">▶ Play</button>
        <button id="btnReset" class="btn ghost">Reset</button>
      </div>

      <label>Échelle carte</label>
      <select id="selScale">
        <option value="linear">Linéaire</option>
        <option value="log">Logarithmique</option>
      </select>

      <label>Top N: <span id="lblTopN"></span></label>
      <input id="topNSlider" type="range" min="5" max="30" step="1" />

      <!-- Légende couleurs : 3 échelles simultanées -->
      <div class="controlSeparator"></div>
      <div class="legendPanel">
        <div class="legendPanelTitle">Légende carte</div>
        <div id="mapLegend"></div>
      </div>
    </aside>

    <section class="grid">
      <div class="card card-map">
        <div class="card-title">Carte mondiale</div>
        <svg id="svgMap"></svg>
      </div>

      <div class="card card-top">
        <div class="top-split">
          <div class="top-panel">
            <div class="card-title">Top pays</div>
            <svg id="svgTopCountries"></svg>
          </div>
          <div class="top-panel">
            <div class="card-title">Top continents</div>
            <svg id="svgTopContinents"></svg>
          </div>
        </div>
      </div>

      <div class="card card-scatter">
        <div class="card-title">Intensification agricole</div>
        <div class="card-subtitle">X = Surface récoltée (ha) · Y = Rendement (kg/ha) · Taille = Production (t) · Cliquez pour sélectionner</div>
        <svg id="svgScatter"></svg>
      </div>

      <div class="card card-mini">
        <div class="cardMiniHeader">
          <div class="card-title" style="margin:0">Comparaison temporelle</div>
          <button id="btnClearSelection" class="btn ghost" style="padding:3px 8px; font-size:11px; flex:none">Effacer</button>
        </div>
        <div id="miniTitle" class="card-subtitle">Sélectionnez un pays sur la carte pour commencer</div>
        <svg id="svgMiniLine"></svg>
      </div>
    </section>
  </main>

  <!-- PAGE 2 : DÉTAILS PAYS -->
  <main id="pageCountry" class="page hidden">
    <section class="countryHeader">
      <button id="btnBack" class="btn ghost">← Retour</button>
      <div>
        <div id="countryName" class="countryTitle">Aucun pays sélectionné</div>
        <div id="countryMeta" class="countryMeta">Sélectionnez un pays sur la carte.</div>
      </div>
    </section>

    <section class="countryGrid">
      <div class="card kpis">
        <div class="card-title">Indicateurs clés — année sélectionnée</div>
        <div class="kpiRow">
          <div class="kpi kpi-prod">
            <div class="kpiLabel">Production</div>
            <div id="kpiProd"     class="kpiValue">—</div>
            <div id="kpiProdUnit" class="kpiUnit"></div>
          </div>
          <div class="kpi kpi-area">
            <div class="kpiLabel">Surface récoltée</div>
            <div id="kpiArea"     class="kpiValue">—</div>
            <div id="kpiAreaUnit" class="kpiUnit"></div>
          </div>
          <div class="kpi kpi-yield">
            <div class="kpiLabel">Rendement</div>
            <div id="kpiYield"     class="kpiValue">—</div>
            <div id="kpiYieldUnit" class="kpiUnit"></div>
          </div>
        </div>
      </div>

      <div class="card detailBars">
        <div class="card-title">Rang mondial — % du maximum (année sélectionnée)</div>
        <div class="card-subtitle">Chaque indicateur est normalisé par rapport au pays leader mondial</div>
        <svg id="svgBars"></svg>
      </div>

      <div class="card smallMultiples">
        <div class="card-title">Évolution historique (1961–2024)</div>
        <div class="card-subtitle">Série temporelle par indicateur</div>
        <svg id="svgSparklines"></svg>
      </div>

      <div class="card cropBreakdown">
        <div class="card-title">Répartition par culture</div>
        <div class="card-subtitle">Toutes les cultures · <span id="cropBreakdownMeta"></span></div>
        <svg id="svgCropBars"></svg>
      </div>
    </section>
  </main>

  <!-- PAGE 3 : STATISTIQUES -->
  <main id="pageStats" class="page hidden">
    <section class="statsHeader">
      <div class="statsTitle">Statistiques mondiales</div>
      <div id="statsMeta" class="statsMeta">—</div>
    </section>

    <section class="statsGrid">
      <div class="card statsCard">
        <div class="card-title">Répartition par culture</div>
        <div class="card-subtitle">Part de chaque culture dans le total mondial</div>
        <div class="donutWrap">
          <svg id="svgCropDonut"></svg>
          <div id="cropDonutLegend" class="donutLegend"></div>
        </div>
      </div>

      <div class="card statsCard">
        <div class="card-title">Répartition par continent</div>
        <div class="card-subtitle">Part de chaque continent dans le total mondial</div>
        <div class="donutWrap">
          <svg id="svgContinentDonut"></svg>
          <div id="continentDonutLegend" class="donutLegend"></div>
        </div>
      </div>

      <div class="card statsCardWide">
        <div class="card-title">Évolution de la part de marché par culture (1961–2024)</div>
        <div class="card-subtitle">Part relative (%) de chaque culture dans la production mondiale totale</div>
        <svg id="svgStackedArea"></svg>
      </div>
    </section>
  </main>

  <div id="tooltip" class="tooltip hidden"></div>

  <div id="loadingOverlay" class="loading-overlay">
    <div class="spinner"></div>
    <p>Chargement des données…</p>
    <small>Dataset FAOSTAT · 217 389 lignes</small>
  </div>

  <script src="main.js"></script>
</body>
</html>
